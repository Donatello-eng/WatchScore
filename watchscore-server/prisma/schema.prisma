datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider  = "prisma-client-py"
  interface = "asyncio"
}

model Watch {
  id             Int       @id @default(autoincrement())
  name           String?
  subtitle       String?
  brand          String?
  model          String?
  year           Int?
  overallLetter  String?
  overallNumeric Int?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  photos         Photo[]
  analysis       WatchAnalysis?

  @@unique([brand, model, year])
}

model Photo {
  id        Int      @id @default(autoincrement())
  watchId   Int
  watch     Watch    @relation(fields: [watchId], references: [id], onDelete: Cascade)
  url       String   // REQUIRED now
  mime      String?
  index     Int?
  provider  String?
  bucket    String?
  key       String?
  width     Int?
  height    Int?
  createdAt DateTime @default(now())

  @@index([watchId])
}

model WatchAnalysis {
  id        Int      @id @default(autoincrement())
  watchId   Int      @unique
  watch     Watch    @relation(fields: [watchId], references: [id], onDelete: Cascade)
  aiJsonStr String
  createdAt DateTime @default(now())
}